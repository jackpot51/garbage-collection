#include "../common/X11.h"
char OSXKEY[];

void updatekeymap(){
    XEvent e;
    while(XCheckWindowEvent(_dpy, _win, KeyPressMask | KeyReleaseMask , &e)){
		char key = OSXKEY[e.xkey.keycode-8];
		if(e.type==KeyRelease){
			keys[key] |= 0x80;
			keys[key] &= 0xBF;
		}
		else if(e.type==KeyPress){
			keys[key] |= 0x40;
			keys[key] &= 0x7F;
	    }
	}
    int i;
    for(i = 0; i < sizeof(keys); i++){
	if(keys[i] & 0x40){
	    keys[i] &= 0xBF;
	    if(keys[i]==0) keys[i] = 1;
	}
	if(keys[i] & 0x80){
	    keys[i] = 0;
	}
    }
    XFlush(_dpy);
}

char OSXKEY[128] = {	
	0x1E,//	0x8
	0x1F,//	0x9
	0x20,//	0xA
	0x21,//	0xB
	0x23,//	0xC
	0x22,//	0xD
	0x2C,//	0xE
	0x2D,//	0xF
	0x2E,//	0x10
	0x2F,//	0x11
	0,//	0x12
	0x30,//	0x13
	0x10,//	0x14
	0x11,//	0x15
	0x12,//	0x16
	0x13,//	0x17
	0x15,//	0x18
	0x14,//	0x19
	0x2,//	0x1A
	0x3,//	0x1B
	0x4,//	0x1C
	0x5,//	0x1D
	0x7,//	0x1E
	0x6,//	0x1F
	0xD,//	0x20
	0xA,//	0x21
	0x8,//	0x22
	0xC,//	0x23
	0x9,//	0x24
	0xB,//	0x25
	0x1B,//	0x26
	0x18,//	0x27
	0x16,//	0x28
	0x1A,//	0x29
	0x17,//	0x2A
	0x19,//	0x2B
	0x1C,//	0x2C
	0x26,//	0x2D
	0x24,//	0x2E
	0x28,//	0x2F
	0x25,//	0x30
	0x27,//	0x31
	0x2B,//	0x32
	0x33,//	0x33
	0x35,//	0x34
	0x31,//	0x35
	0x32,//	0x36
	0x34,//	0x37
	0xF,//	0x38
	0x39,//	0x39
	0x29,//	0x3A
	0xE,//	0x3B
	0x1,//	0x3D
	0,//	0x3E
	0,//	0x3F
	0x2A,//	0x40
	0x3A,//	0x41
	0,//	0x42
	0x1D,//	0x43
	0x36,//	0x44
	0x38,//	0x45
	0,//	0x46
	0,//	0x47
	0,//	0x48
	0,//	0x49
	0,//	0x4A
	0,//	0x4B
	0,//	0x4C
	0,//	0x4D
	0,//	0x4E
	0,//	0x4F
	0,//	0x50
	0,//	0x51
	0,//	0x52
	0,//	0x53
	0,//	0x54
	0,//	0x55
	0,//	0x56
	0,//	0x57
	0,//	0x58
	0,//	0x59
	0,//	0x5A
	0,//	0x5B
	0,//	0x5C
	0,//	0x5D
	0,//	0x5E
	0,//	0x5F
	0x3F,//	0x60
	0x40,//	0x61
	0x41,//	0x62
	0x3D,//	0x63
	0,//	0x64
	0,//	0x65
	0,//	0x66
	0,//	0x67
	0,//	0x68
	0,//	0x69
	0,//	0x6A
	0,//	0x6B
	0,//	0x6C
	0,//	0x6D
	0,//	0x6E
	0,//	0x6F
	0,//	0x70
	0,//	0x71
	0,//	0x72
	0x47,//	0x73
	0x49,//	0x74
	0x53,//	0x75
	0x3E,//	0x76
	0x4F,//	0x77
	0x3C,//	0x78
	0x51,//	0x79
	0x3B,//	0x7A
	0x4B,//	0x7B
	0x4D,//	0x7C
	0x50,//	0x7D
	0x48,//	0x7E
	0,//	0x7F
};